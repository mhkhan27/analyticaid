% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/survey_analysis.R
\name{survey_collapse_numeric_long}
\alias{survey_collapse_numeric_long}
\title{Collapse a logical/numeric survey variable to tidy long stats (weighted & unweighted counts)}
\usage{
survey_collapse_numeric_long(
  df,
  x,
  disag = NULL,
  reporting_col = c("both", "weighted", "unweighted"),
  na_val = NA_real_,
  sm_sep = "/"
)
}
\arguments{
\item{df}{A \code{tbl_svy} object created with \code{srvyr::as_survey()} (or compatible).}

\item{x}{Character scalar. The name of the variable to collapse.
Can be logical (treated as TRUE/FALSE) or numeric (treated as continuous).}

\item{disag}{Optional character vector of column names to disaggregate by
(analogous to \code{dplyr::group_by()} before collapsing).}

\item{reporting_col}{One of "weighted", "both", or "unweighted".}

\item{na_val}{Replacement value for \code{NA}s before aggregation.
If \code{NA_real_} (default), rows with missing \code{x} are removed.
If a number is provided, missing \code{x} are replaced with that value.}

\item{sm_sep}{Single-character separator used by select-multiple columns
(default \code{"/"}). The function derives a \code{variable} column by
removing the child suffix after the last occurrence of this separator.}
}
\value{
A tibble with at least:
\describe{
\item{stat}{Survey-weighted mean (with variance columns from \code{vartype="ci"}).}
\item{weighted_n}{Survey-weighted count (TRUE for logical; non-missing for numeric).}
\item{unweighted_n}{Unweighted count (TRUE for logical; non-missing for numeric).}
\item{median}{(Numeric only) Survey-weighted median (with variance columns).}
\item{variable_val}{The original \code{x} name.}
\item{variable}{Parent variable name (child suffix after \code{sm_sep} removed).}
\item{subset_\emph{\emph{name / subset}}_val}{Present when \code{disag} is provided.}
}
}
\description{
Aggregates a single variable from a \code{srvyr} design into tidy long format,
returning the survey-weighted mean (with variance stats), and both
\strong{weighted} and \strong{unweighted} counts. If \code{disag} variables
are supplied, results are computed by group and annotated with
\code{subset_*_name} / \code{subset_*_val} columns (via \code{mutate_key_pair()}).
For select-multiple style names, the parent variable is derived by trimming
the suffix after \code{sm_sep}.
}
\details{
\itemize{
\item For \emph{logical} \code{x}: \code{stat} is the weighted proportion of TRUE;
\code{weighted_n} is the survey-weighted count of TRUE; \code{unweighted_n}
is the raw count of TRUE (ignoring weights).
\item For \emph{numeric} \code{x}: \code{stat} is the weighted mean;
\code{weighted_n} / \code{unweighted_n} count non-missing values;
\code{median} is the survey-weighted median (with variance stats).
}
}
\section{Notes}{

This function expects \code{df} to be a survey design (\code{tbl_svy}) built with
the correct weights/strata/PSU. The helper \code{mutate_key_pair()} must be available
in your package namespace if you want the subset name/value columns added.
}

\examples{
\dontrun{
library(dplyr)
library(srvyr)

# toy data
set.seed(1)
dat <- tibble(
  w     = runif(100, 0.5, 2),
  sex   = sample(c("F","M"), 100, TRUE),
  urban = sample(c("U","R"), 100, TRUE),
  smoke = sample(c(TRUE, FALSE), 100, TRUE),
  bmi   = rnorm(100, 23, 3)
)

dsgn <- as_survey(dat, weights = w)

# Logical example: weighted proportion/count of smokers, by sex
survey_collapse_numeric_long(dsgn, x = "smoke", disag = "sex")

# Numeric example: weighted mean/median of BMI, overall
survey_collapse_numeric_long(dsgn, x = "bmi")
}

}
\seealso{
\code{\link[srvyr]{survey_mean}}, \code{\link[srvyr]{survey_total}},
\code{\link[srvyr]{survey_median}}
}
